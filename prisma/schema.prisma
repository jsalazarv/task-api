generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ==================== ENUMS ====================

enum UserRole {
  USER
  ADMIN
  MODERATOR
}

enum SubscriptionTier {
  FREE
  PREMIUM
}

enum BillingInterval {
  MONTHLY
  ANNUAL
  LIFETIME
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  EXPIRED
  PAST_DUE
  TRIALING
}

// ==================== MODELS ====================

model User {
  id              String    @id @default(uuid())
  email           String    @unique
  name            String
  passwordHash    String    @map("password_hash")
  
  // Profile
  avatarUrl       String?   @map("avatar_url")
  
  // Email verification
  emailVerified   Boolean   @default(false) @map("email_verified")
  emailVerifiedAt DateTime? @map("email_verified_at")
  
  // Permissions
  role            UserRole  @default(USER)
  
  // Soft delete
  isActive        Boolean   @default(true) @map("is_active")
  
  // Timestamps
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  
  // Relations
  subscriptions   Subscription[]
  
  @@map("users")
}

model Subscription {
  id                    String              @id @default(uuid())
  userId                String              @map("user_id")
  
  // Subscription details
  tier                  SubscriptionTier
  billingInterval       BillingInterval?    @map("billing_interval")
  status                SubscriptionStatus  @default(ACTIVE)
  
  // Dates
  startedAt             DateTime            @default(now()) @map("started_at")
  expiresAt             DateTime?           @map("expires_at")
  canceledAt            DateTime?           @map("canceled_at")
  cancelAtPeriodEnd     Boolean             @default(false) @map("cancel_at_period_end")
  
  // Stripe integration
  stripeCustomerId      String?             @map("stripe_customer_id")
  stripeSubscriptionId  String?             @unique @map("stripe_subscription_id")
  stripePriceId         String?             @map("stripe_price_id")
  stripeCurrentPeriodEnd DateTime?          @map("stripe_current_period_end")
  
  // Payment metadata
  price                 Decimal?            @db.Decimal(10, 2)
  currency              String              @default("USD")
  
  // Timestamps
  createdAt             DateTime            @default(now()) @map("created_at")
  updatedAt             DateTime            @updatedAt @map("updated_at")
  
  // Relations
  user                  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([status])
  @@index([expiresAt])
  @@map("subscriptions")
}
